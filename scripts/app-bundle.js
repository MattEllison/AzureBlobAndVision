define("app",["require","exports","./resources/service/blobStorage","./resources/service/visionapi"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){var e=this;this.message="Hello World!",this.pictures=new Array,this.visionAPI=new i.VisionApi,this.blobStorage=new n.BloblStorage,this.blobStorage.GetPictures().then(function(t){console.log("Got pics",t),t.forEach(function(t){e.blobStorage.GetBlobCaption(t.filename).then(function(n){t.caption=n,e.pictures.push(t)})})})}return e.prototype.NewName=function(){return"https://catstorageorix.blob.core.windows.net/temp/"+this.files[0].name+"?sv=2017-04-17&ss=bfqt&srt=sco&sp=rwdlacup&se=2017-11-04T20:50:05Z&st=2017-11-04T12:50:05Z&spr=https&sig=mdbAJAV5j9l7h3Fa1nP1Nl%2Bu1f6uwGDv1GidxPCxdfo%3D"},e.prototype.MetaDataHeader=function(){return"https://catstorageorix.blob.core.windows.net/temp/"},e.prototype.Submit=function(){var e=this;this.blobStorage.SavePicture(this.files[0]).then(function(t){var n="https://catstorageorix.blob.core.windows.net/temp/"+t.filename;e.visionAPI.processImage(n).then(function(n){t.caption=n.caption,e.blobStorage.updateMetaDataForPicture(t).then(function(t){e.pictures.push(t)})})}),console.log("Submitted Again")},e}();t.App=o}),define("environment",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={debug:!1,testing:!1}}),define("main",["require","exports","./environment"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configure=function(e){e.use.standardConfiguration().feature("resources"),n.default.debug&&e.use.developmentLogging(),n.default.testing&&e.use.plugin("aurelia-testing"),e.start().then(function(){return e.setRoot()})}}),define("Models/Picture",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){}}();t.Picture=n}),define("Models/VisionResponse",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e){this.caption=e.description.captions[0].text,this.name=this.caption=e.description.captions[0].text}}();t.VisionResponse=n}),define("resources/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configure=function(e){}}),define("resources/service/blobStorage",["require","exports","./../../Models/Picture","aurelia-http-client"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.pictureContainer="https://catstorageorix.blob.core.windows.net/temp",this.sharedKeyInfo="sv=2017-04-17&ss=bfqt&srt=sco&sp=rwdlacup&se=2017-11-24T20:50:05Z&st=2017-11-04T12:50:05Z&spr=https&sig=lTzCFbApWqiRXlCJ6RHSim9BP2GsYMucxtVGxssxfWg%3D"}return e.prototype.SavePicture=function(e){var t=this;return(new i.HttpClient).configure(function(e){e.withHeader("x-ms-blob-type","BlockBlob")}).put(this.pictureContainer+"/"+e.name+"?"+this.sharedKeyInfo,e).then(function(i){var o=new n.Picture;return o.filename=e.name,o.url=t.pictureContainer+"/"+e.name,o})},e.prototype.updateMetaDataForPicture=function(e){console.log("Meta data update",e);var t=(new i.HttpClient).configure(function(e){e.withHeader("x-ms-blob-type","BlockBlob")});return console.log("Vision response",e),t.createRequest(this.pictureContainer+"/"+e.filename+"?comp=metadata&"+this.sharedKeyInfo).withHeader("x-ms-meta-caption",e.caption).asPut().send().then(function(){return e})},e.prototype.GetPictures=function(){var e=this,t=(new i.HttpClient).configure(function(e){e.withHeader("Content-Type","application/json")}),o=this.pictureContainer+"?restype=container&comp=list&"+this.sharedKeyInfo;return console.log("Container Emails",o),t.get(o).then(function(t){var i=new Array;console.log("Getting Pics",t);var o=(new DOMParser).parseFromString(t.response,"text/xml");console.log(o);for(var r=o.getElementsByTagName("Blob"),s=0;s<r.length;s++){console.log("Blob",r[s]);var a=r[s].getElementsByTagName("Name")[0].innerHTML,u=new n.Picture;u.caption=a,u.name=a,u.url=e.pictureContainer+"/"+a,u.filename=a,i.push(u)}return i})},e.prototype.GetBlobCaption=function(e){var t=new i.HttpClient;return console.log("Blob url ",this.pictureContainer+"/"+e+"?"+this.sharedKeyInfo),t.get(this.pictureContainer+"/"+e+"?"+this.sharedKeyInfo).then(function(e){return e.headers.headers["x-ms-meta-caption"].value})},e}();t.BloblStorage=o}),define("resources/service/visionapi",["require","exports","./../../Models/VisionResponse","aurelia-http-client"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){var e=this;this.subscriptionKey="311f1c6de3f946e68713e6ca28c580d7",this.httpClient=(new i.HttpClient).configure(function(t){t.withHeader("Ocp-Apim-Subscription-Key",e.subscriptionKey)})}return e.prototype.processImage=function(e){console.log("Processing image",e);return this.httpClient.post("https://westcentralus.api.cognitive.microsoft.com/vision/v1.0/analyze?visualFeatures=description",{url:e}).then(function(e){return console.log("I did get a result",e),new n.VisionResponse(JSON.parse(e.response))})},e.prototype.updateMetaDataForPicture=function(e){console.log("Vision response",e),this.httpClient.createRequest(e.url+"?comp=metadata").withHeader("x-ms-meta-caption",e.caption).asPut().send()},e}();t.VisionApi=o}),define("text!app.html",["module"],function(e){e.exports='<template><h1>Upload Pictures</h1><form submit.trigger="Submit()"><div><input type="file" accept="image/*" files.bind="files"></div><div><button type="submit">Submit</button></div></form><p repeat.for="pic of pictures"><img width="250px" src.bind="pic.url"> <span>${pic.caption}</span></p></template>'});